<!--pages/video-crop/video-crop.wxml-->
<wxs module="utils" src="../video-edit/utils.wxs"></wxs>
<view class="container">
  <!-- 视频预览区域 -->
  <view class="preview-section">
    <view 
      class="preview-wrapper"
      bindtouchstart="onCropTouchStart"
      bindtouchmove="onCropTouchMove"
    >
      <view 
        class="crop-container" 
        style="transform: scale({{cropScale}}) translate({{cropTranslateX}}px, {{cropTranslateY}}px);"
      >
        <video 
          id="videoPlayer"
          src="{{videoPath}}" 
          class="video-player"
          controls="{{false}}"
          show-center-play-btn="{{false}}"
          enable-play-gesture="{{false}}"
          object-fit="contain"
          bindtimeupdate="onVideoTimeUpdate"
          bindplay="onVideoPlay"
          bindpause="onVideoPause"
          bindended="onVideoEnded"
          binderror="onVideoError"
          bindloadedmetadata="onVideoLoadedMetadata"
        ></video>
      </view>
      
      <!-- 裁剪框 -->
      <view class="crop-overlay">
        <view class="crop-frame"></view>
        <view class="crop-mask crop-mask-top"></view>
        <view class="crop-mask crop-mask-bottom"></view>
        <view class="crop-mask crop-mask-left"></view>
        <view class="crop-mask crop-mask-right"></view>
      </view>
    </view>
  </view>

  <!-- iOS风格时间轴组件 -->
  <view class="timeline-section">
    <view class="timeline-container">
      <!-- 播放按钮 -->
      <view class="play-btn-wrapper">
        <view class="play-btn {{isPlaying ? 'playing' : ''}}" bindtap="togglePlay">
          <view class="play-icon-triangle" wx:if="{{!isPlaying}}"></view>
          <view class="play-icon-pause" wx:else>
            <view class="pause-line"></view>
            <view class="pause-line"></view>
          </view>
        </view>
      </view>
      
      <!-- 时间轴 -->
      <view class="timeline-wrapper">
        <view 
          class="timeline-track" 
          bindtouchstart="onTimelineTouchStart" 
          bindtouchmove="onTimelineTouchMove" 
          bindtouchend="onTimelineTouchEnd"
        >
          <!-- 背景进度条 -->
          <view class="timeline-bg">
            <view class="timeline-progress" style="width: {{(currentTime / videoDuration) * 100}}%"></view>
          </view>
          
          <!-- 选择框 -->
          <view 
            class="timeline-selection" 
            style="left: {{(trimStart / videoDuration) * 100}}%; width: {{((trimEnd - trimStart) / videoDuration) * 100}}%"
          >
            <!-- 开始拖拽手柄 -->
            <view 
              class="timeline-handle timeline-handle-start"
              data-type="start"
              bindtouchstart="onHandleTouchStart"
              bindtouchmove="onHandleTouchMove"
              bindtouchend="onHandleTouchEnd"
            ></view>
            
            <!-- 结束拖拽手柄 -->
            <view 
              class="timeline-handle timeline-handle-end"
              data-type="end"
              bindtouchstart="onHandleTouchStart"
              bindtouchmove="onHandleTouchMove"
              bindtouchend="onHandleTouchEnd"
            ></view>
          </view>
          
          <!-- 当前播放位置指示器 -->
          <view 
            class="timeline-indicator" 
            style="left: {{(currentTime / videoDuration) * 100}}%"
            wx:if="{{isPlaying}}"
          ></view>
        </view>
        
        <!-- 时间标签 -->
        <view class="timeline-labels">
          <text class="time-label">{{utils.toFixed(trimStart, 1)}}s</text>
          <text class="time-label">{{utils.toFixed(trimEnd, 1)}}s</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 提示文案 -->
  <view class="crop-hint">
    <text>使用两根手指缩放视频，调整需要的区域</text>
  </view>

  <!-- 确认按钮 -->
  <view class="crop-confirm-section">
    <button class="crop-confirm-btn" bindtap="confirmCrop">确认</button>
  </view>
</view>
