<!--pages/video-edit/video-edit.wxml-->
<view class="container">
  <!-- 序列帧预览区域 -->
  <view class="preview-section">
    <view class="preview-wrapper">
      <!-- 左侧：原始视频 -->
      <view class="preview-item preview-left">
        <view class="preview-label">原始视频</view>
        <view class="preview-content">
          <video 
            wx:if="{{originalVideoPath}}"
            id="originalVideo"
            src="{{originalVideoPath}}" 
            class="preview-video"
            controls="{{false}}"
            show-center-play-btn="{{false}}"
            enable-play-gesture="{{true}}"
            object-fit="contain"
            muted="{{true}}"
            loop="{{isPlaying}}"
            autoplay="{{false}}"
            bindplay="onOriginalVideoPlay"
            binderror="onVideoError"
          ></video>
          <view wx:else class="video-placeholder">
            <text>无原始视频</text>
          </view>
        </view>
      </view>
      
      <!-- 右侧：已抠图的序列帧 -->
      <view class="preview-item preview-right">
        <view class="preview-label">抠图效果</view>
        <view class="preview-content">
          <!-- 透明背景网格（用于显示透明效果） -->
          <view class="transparent-grid" wx:if="{{hasProcessed}}"></view>
          
          <!-- 测试模式下显示视频，正常模式显示序列帧图片 -->
          <video 
            wx:if="{{isTestMode && originalVideoPath}}"
            id="processedVideo"
            src="{{originalVideoPath}}" 
            class="preview-video"
            controls="{{false}}"
            show-center-play-btn="{{false}}"
            enable-play-gesture="{{true}}"
            object-fit="contain"
            muted="{{true}}"
            loop="{{isPlaying}}"
            autoplay="{{false}}"
          ></video>
          
          <!-- 显示序列帧图片 -->
          <image 
            wx:elif="{{currentFrameUrl}}"
            id="frameImage"
            src="{{currentFrameUrl}}" 
            class="preview-image"
            mode="aspectFit"
          ></image>
          <view wx:else class="video-placeholder">
            <text>加载中...</text>
          </view>
        </view>
      </view>
      
      <!-- 隐藏的Canvas用于处理抠图 -->
      <canvas 
        canvas-id="chromaCanvas" 
        class="color-picker-canvas"
        wx:if="{{!isTestMode}}"
      ></canvas>
      
      <!-- 播放按钮（放在底部中间） -->
      <view class="play-btn-overlay {{isPlaying ? 'playing' : ''}}" bindtap="togglePlay">
        <view class="play-icon-triangle" wx:if="{{!isPlaying}}"></view>
        <view class="play-icon-pause" wx:else>
          <view class="pause-line"></view>
          <view class="pause-line"></view>
        </view>
      </view>
    </view>
  </view>

  <!-- 控制区域 -->
  <view class="control-section">

    <!-- 抠图控制区域 -->
    <view class="chroma-control">
      <view class="control-title">调整抠图效果</view>
      
      <!-- 抠除范围滑杆 -->
      <view class="slider-section">
        <text class="slider-label">色彩容差：{{colorThreshold}}</text>
        <slider 
          value="{{colorThreshold}}" 
          min="0" 
          max="100" 
          step="1"
          show-value="{{false}}"
          bindchange="onThresholdChange"
          activeColor="#D8B4FE"
          backgroundColor="#e5e5e5"
        />
        <view class="slider-hint">
          <text>容差越大，抠除的颜色范围越大</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 导出按钮区域 -->
  <view class="export-section">
    <button class="export-btn" bindtap="onExportGIF">导出GIF表情包文件</button>
    <view class="export-hint">
      <text>图片帧率12fps，尺寸240×240 px，大小小于500kb</text>
    </view>
  </view>
</view>
