# videoToFrames 云函数实现方案

## 当前问题

微信云函数默认环境**不支持 FFmpeg**，无法直接处理视频。

## 解决方案

### 方案一：使用腾讯云视频处理服务（推荐）

腾讯云提供了视频处理服务，可以在云函数中调用。

#### 步骤1：注册腾讯云账号

1. 访问：https://cloud.tencent.com/
2. 注册/登录账号
3. 开通"视频处理"服务

#### 步骤2：获取 API 密钥

1. 登录腾讯云控制台
2. 访问：https://console.cloud.tencent.com/cam/capi
3. 创建 API 密钥（SecretId 和 SecretKey）
4. 保存好这两个密钥

#### 步骤3：修改云函数代码

修改 `cloud/videoToFrames/index.js`：

```javascript
// 云函数：将视频转换为序列帧（使用腾讯云服务）
const cloud = require('wx-server-sdk')
const tencentcloud = require('tencentcloud-sdk-nodejs')

cloud.init({
  env: cloud.DYNAMIC_CURRENT_ENV
})

exports.main = async (event, context) => {
  const {
    videoPath,
    fps = 12,
    width = 240,
    height = 240
  } = event

  try {
    // 1. 下载视频到本地
    const downloadRes = await cloud.downloadFile({
      fileID: videoPath
    })
    
    // 2. 调用腾讯云视频处理服务
    // 注意：需要先安装 tencentcloud-sdk-nodejs
    // npm install tencentcloud-sdk-nodejs
    
    // 这里需要配置你的腾讯云密钥
    // const VpcClient = tencentcloud.vpc.v20170312.Client
    // ... 调用腾讯云API处理视频
    
    // 3. 返回序列帧URL
    return {
      success: true,
      frameUrls: [] // 处理后的序列帧URL数组
    }
    
  } catch (error) {
    console.error('处理失败:', error)
    return {
      success: false,
      error: error.message,
      frameUrls: []
    }
  }
}
```

---

### 方案二：使用自定义运行环境 + FFmpeg（复杂）

需要配置 Docker 环境，对小白用户不友好。

---

### 方案三：暂时使用测试模式（最简单）

**推荐小白用户使用这个方案：**

1. 上传视频后，点击"继续测试"
2. 可以预览界面效果
3. 等有技术基础了，再完善云函数代码

---

## 快速检查

### 检查云函数是否已部署

1. 打开微信开发者工具
2. 点击顶部"云开发"按钮
3. 点击"云函数"
4. 查看 `videoToFrames` 是否显示"已部署"

### 检查代码状态

打开 `cloud/videoToFrames/index.js`，如果看到：
- `success: false`
- `error: '云函数代码需要完善'`

说明代码还是框架，需要完善。

---

## 建议

**对于完全不懂编程的用户：**

1. **先使用测试模式**体验功能
2. **找懂技术的朋友**帮忙配置云函数
3. 或者**使用第三方服务**（需要注册账号和配置）

---

## 需要帮助？

如果你有懂技术的朋友，可以让他们：
1. 配置腾讯云视频处理服务
2. 或者配置自定义运行环境
3. 或者使用其他技术方案
